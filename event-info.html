<html lang="en">
	<head>
		<meta charset="utf-8" />
		<script src="js/kcSHIPDATA.js"></script>
		<script src="js/kcEQDATA.js"></script>
		<script src="js/chkcMAPDATA2.js"></script>
		<script src="js/kcENEMYCOMP.js"></script>
		<script src="js/jquery-1.11.3.min.js"></script>
		<style>
		table{ border: 2px black solid; }
		#guideE1{  }
		#guideE2 { display:none; }
		</style>
	</head>
	<body>
		<input type="radio" onclick="updateMap()" name="maps" value="E-1" checked>E-1
		<input type="radio" onclick="updateMap()" name="maps" value="E-2">E-2
		
		<div id="guideE1">
		<h2>E-1 Strategy Guide</h2>
		<i>Admiral, abyssal forces have invaded the southwestern seas once again, cutting us off from vital locations in the area.<br>
		Use a Combined Fleet to eliminate their presence.<br>
		<ul>
		<li>LBAS is available for use on this map.</li>
		<li>You may sortie either a Carrier Task Force or a Surface Task Force to this map.</li>
		<li>Be sure to thoroughly clear the area before proceeding to the target.</li>
		<li>Thanks to Minhfongboy for providing difficulty scaling and the home screen map icon.</li>
		</ul></i>
		E-1 is divided into two routes: North and South. The North route is accesible with a CTF, the South via a STF. Both routes must be taken in order to unlock the debuff present in the map.
		<br>
		<h3>Progression</h3>
		<h3>Part 1: Unlock the Debuff</h3>
		Particularly on Medium and Hard, the fleet at the boss node is incredibly strong and almost impossible to take down. Thankfully, a debuff is present in the map that gives you a 1.45x postcap damage 
		multiplier on all of your ships. You trigger this debuff by obtaining an S-rank at nodes S, T, and V.
		<h4>S-rank Node T</h4>
		This must be done using a Surface Task Force. Bringing 3 DD while keeping the fleet light appears to be the key to taking a shorter route. Once you get there, S-ranking this node is relatively straightforward and painless.
		<h4>S-rank Nodes S, V</h4>
		This must be done using a Carrier Task Force. The only real branching rule on the North route is from C -> H; to skip the sub node E a fast fleet with 4 or fewer BB + CV seems to be required. Node V has incredibly high airpower, 
		bringing 4CV is highly recommended, as is AACI to tolerate the mutliple air raid and air battle nodes on the way to S and V. S-ranking node S is pretty easy when you get there, node V on the other hand may take you a few tries.
		<h3>Part 2: Kill the Boss</h3>
		After unlocking the debuff, all that is left is to kill the boss. With the high postcap damage modifier you should make quick work of her assuming your fleet is loaded out appropriately. You can use either a Surface 
		Task Force or Carrier Task Force for this portion. A Fleet Oiler is needed if you wish to avoid incurring a damage penalty at the boss due to the length of the preboss on either route.
		<br><br><img src="assets/info/E-1 full.png"><br><br>
		</div>
		<div id="guideE2">
		<h2>E-2 Strategy Guide</h2>
		<i>Commander, our next objective is to reclaim MI Island from an overwhelming abyssal force in what we will call 'Operation 139'.<br>
		In preparation, secure dominance in the MR Isles by reclaiming captured transports and eliminating the enemy airbase.<br>
		After doing so, continue further into the region and investigate an anomaly that may interfere with execution of Operation 139.<br>
		Commander, we are counting on you!<br>
		<ul>
		<li>LBAS is available for use on this map.</li>
		<li>LBAS bases available for use will expand as you capture enemy airbases.</li>
		<li>Capturing transports is vital to success in the transport operation.</li>
		<li>Thanks again to Minhfongboy for creating difficulty scaling, and to Prinz Eugen-sama for providing boss assets.</li>
		</ul></i>
		<br><br><img src="assets/info/E-2 full.png"><br><br>
		<br><br><img src="assets/info/E-2 rangemap.png"><br><br>
		</div>
		<br>
		<h3>Enemy Compositions (Press Button to View for Respective Difficulty)</h3>
		<button onclick="loadComps('Casual')">Casual</button>
		<button onclick="loadComps('Easy')">Easy</button>
		<button onclick="loadComps('Medium')">Medium</button>
		<button onclick="loadComps('Hard')">Hard</button>
		<div id="enemyComps"></div>
		<script>
		let imgPath = "assets/icons/";
		let enemyID = 0, imgString, mapString = 'E-1', mapNumber = 1;
		function muhAirpower(enemy){
			var ap = 0;
			for (let i=0; i<enemy.EQUIPS.length; i++) {
				if (EQTDATA[EQDATA[enemy.EQUIPS[i]].type].isfighter) {
					ap += Math.floor((EQDATA[enemy.EQUIPS[i]].AA||0) * Math.sqrt(enemy.SLOTS[i]) + (EQDATA[enemy.EQUIPS[i]].APbonus||0));
				}
			}
			return ap;
		}
		
		function updateMap(){
			let checkedButton = $('input[name=maps]:checked').val();
			if(checkedButton == "E-1"){
				mapString = checkedButton;
				mapNumber = 1;
				$('#guideE1').css('display', 'block');
				$('#guideE2').css('display', 'none');
			}
			else if(checkedButton == "E-2"){
				mapString = checkedButton;
				mapNumber = 2;
				$('#guideE1').css('display', 'none');
				$('#guideE2').css('display', 'block');
			}
			$('#enemyComps').empty();
		}
		
		function generateTitle(enemyID){
			let name = SHIPDATA[enemyID].name;
			let hp = SHIPDATA[enemyID].HP;
			let armor = SHIPDATA[enemyID].AR;
			let statoverrides = MAPDATA[99].overrideStats;
			for(let id in statoverrides){
				if(enemyID == id){
					if(statoverrides[id].AR) armor = statoverrides[id].AR;
					if(statoverrides[id].HP) hp = statoverrides[id].HP;
				}
			}
			return "ID " + enemyID + ": " + name + ", " + hp + " HP, " + armor + " Armor";
		}
		
		function formationConvert(formation){
			switch(formation){
				case 1:
					return "Line Ahead";
				case 2:
					return "Double Line";
				case 3:
					return "Diamond";
				case 4:
					return "Echelon";
				case 5:
					return "Line Abreast";
				case 111:
					return "C. Form 1";
				case 112:
					return "C. Form 2";
				case 113:
					return "C. Form 3";
				case 114:
					return "C. Form 4";
				default:
					return "Unknown";
			}
		}
		
		function loadComps(diff){
			let nodes = ENEMYCOMPS['Fubuki\'s Challenge'][mapString];
			let mapdata = MAPDATA[99].maps[mapNumber];
			$('#enemyComps').empty();
			$('<h2>' + mapString + ' ' + diff + ' Compositions</h2>').appendTo('#enemyComps');
			for(let node in nodes){
				// create initial table for the node
				let id = mapString + node;
				// determine node type
				let type = (mapdata.nodes[node].raid) ? "Air Raid Node" : ((mapdata.nodes[node].night2) ? "Night Battle Node" : ((mapdata.nodes[node].aironly) ? "Aerial Battle Node" : ((mapdata.nodes[node].boss) ? "Boss Battle Node" : "Normal Battle Node")));
				let nodeLetter = false, counter = 0;
				// create table header
				$('<table id="' + id + '"><tr><th>' + '</th><th>Formation</th><th>' + type + '</th><th>AD / AP / AS / AS+</th></tr>').appendTo('#enemyComps');
				for(let comps in nodes[node]){
					if(comps.includes(diff)) {
						let temp = comps;
						temp = temp.replace(/\s+/g, '');
						$('<tr id="' + id + "_" + temp + '">').appendTo('#' + id + ' > tbody');
						// create node letter column, include rowspan element (to be overwritten later)
						if(!nodeLetter){
							$('<td id="nodeLetter-' + node + '" rowspan=1>' + node + '</td>').appendTo('#' + id + "_" + temp);
							nodeLetter = true;
						}
						$('<td class="formation">' + formationConvert(nodes[node][comps].f) + '</td>').appendTo('#' + id + "_" + temp);
						$('<td class="comp-' + temp + '">').appendTo('#' + id + "_" + temp);
						let airpower = 0;
						for(let enemy in nodes[node][comps].c){
							if(enemyID != nodes[node][comps].c[enemy]){
								enemyID = nodes[node][comps].c[enemy];
								imgString = imgPath + SHIPDATA[enemyID].image;
							}
							airpower += muhAirpower(SHIPDATA[enemyID]);
							$('<img src="' + imgString + '" />').attr('title', generateTitle(enemyID)).appendTo('#' + id + "_" + temp + ' > .comp-' + temp);
						}
						if(nodes[node][comps].ce){
							$('<br />').appendTo('#' + id + "_" + temp + ' > .comp-' + temp);
							for(let enemy in nodes[node][comps].ce){
								if(enemyID != nodes[node][comps].ce[enemy]){
									enemyID = nodes[node][comps].ce[enemy];
									imgString = imgPath + SHIPDATA[enemyID].image;
								}
								airpower += muhAirpower(SHIPDATA[enemyID]);
								$('<img src="' + imgString + '" />').attr('title', generateTitle(enemyID)).appendTo('#' + id + "_" + temp + ' > .comp-' + temp);
							}
							counter++;
						}
						Math.floor(airpower);
						if(airpower > 0) $('#' + id + "_" + temp).append("<td>" + Math.floor(airpower * 0.33333) + " / " + Math.floor(airpower * 0.66666) + " / " + Math.floor(airpower * 1.5) + " / " + Math.floor(airpower * 3) + "</td>");
						counter++;
					}
				}
				$('#nodeLetter-' + node).attr('rowspan', counter);
				$('<br />').appendTo('#enemyComps');
			}
		}
		</script>
	</body>
</html>